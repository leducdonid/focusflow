<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FocusFlow ‚Äî ·ª®ng d·ª•ng t·∫≠p trung</title>
    <meta name="description" content="FocusFlow gi√∫p b·∫°n t·∫≠p trung l√†m vi·ªác hi·ªáu qu·∫£ v·ªõi quy tr√¨nh 3 b∆∞·ªõc: X√°c ƒë·ªãnh ∆∞u ti√™n, L√™n l·ªãch, T·∫≠p trung s√¢u. S·ª≠ d·ª•ng Ma tr·∫≠n Eisenhower v√† Pomodoro Timer." />
    <meta name="theme-color" content="#0a0f0d" />
    <meta name="color-scheme" content="dark light" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-96.png" />

    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="FocusFlow" />
    <link rel="apple-touch-icon" href="icons/icon-152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png" />

    <!-- Microsoft Tile -->
    <meta name="msapplication-TileColor" content="#0a0f0d" />
    <meta name="msapplication-TileImage" content="icons/icon-144.png" />

    <!-- Open Graph / Social Sharing -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="FocusFlow ‚Äî ·ª®ng d·ª•ng t·∫≠p trung" />
    <meta property="og:description" content="T·∫≠p trung l√†m vi·ªác hi·ªáu qu·∫£ v·ªõi quy tr√¨nh 3 b∆∞·ªõc: X√°c ƒë·ªãnh ∆∞u ti√™n, L√™n l·ªãch, T·∫≠p trung s√¢u." />
    <meta property="og:image" content="https://gybagent.github.io/focusflow/og-image.png" />
    <meta property="og:url" content="https://gybagent.github.io/focusflow/" />
    <meta property="og:site_name" content="FocusFlow" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="FocusFlow ‚Äî ·ª®ng d·ª•ng t·∫≠p trung" />
    <meta name="twitter:description" content="T·∫≠p trung l√†m vi·ªác hi·ªáu qu·∫£ v·ªõi quy tr√¨nh 3 b∆∞·ªõc." />
    <meta name="twitter:image" content="https://gybagent.github.io/focusflow/og-image.png" />

    <link rel="stylesheet" href="styles.css" />

    <!-- Module Stylesheets -->
    <link rel="stylesheet" href="modules/onboarding.css" />
    <link rel="stylesheet" href="modules/gamification.css" />
    <link rel="stylesheet" href="modules/sounds.css" />
    <link rel="stylesheet" href="modules/sharing.css" />
    <link rel="stylesheet" href="modules/auth.css" />
    <script>
      // Theme initialization ‚Äî runs before first paint to prevent flash of wrong theme
      (function() {
        var THEME_KEY = 'focusflow_theme';
        var stored = null;
        try { stored = localStorage.getItem(THEME_KEY); } catch(e) {}
        var pref = stored || 'auto';
        var resolved = pref;
        if (pref === 'auto') {
          resolved = (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark';
        }
        document.documentElement.setAttribute('data-theme', resolved);
        var meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute('content', resolved === 'light' ? '#f5f2ec' : '#0a0f0d');
      })();
    </script>
  </head>
  <body data-no-transition>
    <div class="app-shell">
      <!-- Sidebar Navigation -->
      <nav class="nav-sidebar">
        <div class="nav-brand">
          <span class="nav-brand__mark">FF</span>
          <div class="nav-brand__text">
            <h1>FocusFlow</h1>
            <span id="today-date" class="nav-date"></span>
          </div>
        </div>

        <ul class="nav-menu">
          <!-- 3 Flow ch√≠nh -->
          <li class="nav-section-label">Flow</li>
          <li>
            <button class="nav-item nav-item--flow is-active" data-view="tasks" data-step="1" aria-label="B∆∞·ªõc 1: Priority Flow ‚Äî X√°c ƒë·ªãnh vi·ªác ∆∞u ti√™n">
              <span class="nav-step">1</span>
              <span class="nav-icon">üéØ</span>
              <span class="nav-label">Priority Flow</span>
              <span id="nav-tasks-count" class="nav-badge">0</span>
            </button>
          </li>
          <li>
            <button class="nav-item nav-item--flow" data-view="blocks" data-step="2" aria-label="B∆∞·ªõc 2: Time Flow ‚Äî L√™n l·ªãch th·ªùi gian">
              <span class="nav-step">2</span>
              <span class="nav-icon">‚è∞</span>
              <span class="nav-label">Time Flow</span>
              <span id="nav-blocks-count" class="nav-badge">0</span>
            </button>
          </li>
          <li>
            <button class="nav-item nav-item--flow" data-view="timer" data-step="3" aria-label="B∆∞·ªõc 3: Deep Flow ‚Äî T·∫≠p trung s√¢u">
              <span class="nav-step">3</span>
              <span class="nav-icon">üî•</span>
              <span class="nav-label">Deep Flow</span>
              <span id="nav-focus-dot" class="nav-focus-dot"></span>
            </button>
          </li>

          <!-- Ph·∫ßn ph·ª• tr·ª£ -->
          <li class="nav-section-label">Insights</li>
          <li>
            <button class="nav-item" data-view="dashboard" aria-label="Home ‚Äî T·ªïng quan">
              <span class="nav-icon">üè†</span>
              <span class="nav-label">Home</span>
            </button>
          </li>
          <li>
            <button class="nav-item" data-view="stats" aria-label="Analytics ‚Äî Ph√¢n t√≠ch hi·ªáu su·∫•t">
              <span class="nav-icon">üìà</span>
              <span class="nav-label">Analytics</span>
            </button>
          </li>

          <!-- Ph·∫ßn h·ªó tr·ª£ -->
          <li class="nav-section-label">Support</li>
          <li>
            <button class="nav-item" data-view="guide" aria-label="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng">
              <span class="nav-icon">üìñ</span>
              <span class="nav-label">H∆∞·ªõng d·∫´n</span>
            </button>
          </li>
          <li>
            <button class="nav-item" data-view="settings" aria-label="C√†i ƒë·∫∑t ·ª©ng d·ª•ng">
              <span class="nav-icon">‚öôÔ∏è</span>
              <span class="nav-label">Settings</span>
            </button>
          </li>
        </ul>

        <!-- Streak Widget -->
        <div id="streak-widget" class="nav-streak-widget"></div>

        <!-- Mini progress ·ªü sidebar -->
        <div class="nav-progress">
          <div class="nav-progress__ring" id="nav-goal-ring" style="--progress: 0deg">
            <span id="nav-goal-text">0/4</span>
          </div>
          <span class="nav-progress__label">phi√™n h√¥m nay</span>
        </div>

        <!-- Theme Toggle -->
        <div class="nav-theme-toggle">
          <span class="nav-theme-toggle__label">Giao di·ªán</span>
          <label class="theme-switch" title="Chuy·ªÉn giao di·ªán s√°ng/t·ªëi">
            <input type="checkbox" id="sidebar-theme-toggle" aria-label="Chuy·ªÉn giao di·ªán s√°ng/t·ªëi" />
            <span class="theme-switch__track">
              <span class="theme-switch__thumb">
                <span class="theme-switch__icon theme-switch__icon--moon">üåô</span>
                <span class="theme-switch__icon theme-switch__icon--sun">‚òÄÔ∏è</span>
              </span>
            </span>
          </label>
        </div>

        <!-- Credit -->
        <div class="nav-credit">
          <span class="nav-credit__text">Design by</span>
          <span class="nav-credit__brand">GYB Agent</span>
        </div>
      </nav>

      <!-- Mobile Menu Toggle -->
      <button id="mobile-menu-toggle" class="mobile-menu-toggle" aria-label="M·ªü menu ƒëi·ªÅu h∆∞·ªõng" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- View: Dashboard (Home) -->
        <section id="view-dashboard" class="view">
          <header class="view-header view-header--home">
            <div class="view-header__top">
              <div class="view-step-badge view-step-badge--home">
                <span class="view-step-badge__icon">üè†</span>
                <span>Home</span>
              </div>
            </div>
            <h2>Ch√†o bu·ªïi s√°ng ‚òÄÔ∏è</h2>
            <p class="view-desc">NƒÉng l∆∞·ª£ng tr√†n ƒë·∫ßy, s·∫µn s√†ng chinh ph·ª•c!</p>
          </header>

          <!-- Quick Actions -->
          <div class="home-actions">
            <div class="home-action-card home-action-card--primary" data-goto="tasks">
              <div class="home-action-card__icon">üéØ</div>
              <div class="home-action-card__content">
                <h4>B·∫Øt ƒë·∫ßu Flow</h4>
                <p>X√°c ƒë·ªãnh vi·ªác ∆∞u ti√™n ‚Üí L√™n l·ªãch ‚Üí Focus</p>
              </div>
              <span class="home-action-card__arrow">‚Üí</span>
            </div>
          </div>

          <!-- Dashboard Grid -->
          <div class="home-grid">
            <!-- Next Block Card -->
            <div class="home-card">
              <div class="home-card__header">
                <span class="home-card__icon">‚è∞</span>
                <span class="home-card__label">Block s·∫Øp t·ªõi</span>
              </div>
              <p id="dashboard-next-block" class="home-card__value">Ch∆∞a c√≥ block.</p>
              <p id="dashboard-next-block-meta" class="home-card__meta"></p>
              <button id="dashboard-start-block" class="btn btn--outline btn--small">B·∫Øt ƒë·∫ßu block</button>
            </div>

            <!-- Next Task Card -->
            <div class="home-card">
              <div class="home-card__header">
                <span class="home-card__icon">üî•</span>
                <span class="home-card__label">Task ∆∞u ti√™n</span>
              </div>
              <p id="dashboard-next-task" class="home-card__value">Ch∆∞a c√≥ vi·ªác.</p>
              <p id="dashboard-next-task-meta" class="home-card__meta"></p>
              <button id="dashboard-start-task" class="btn btn--outline btn--small">Focus ngay</button>
            </div>

            <!-- Today Progress Card -->
            <div class="home-card home-card--wide">
              <div class="home-card__header">
                <span class="home-card__icon">üìà</span>
                <span class="home-card__label">Ti·∫øn ƒë·ªô h√¥m nay</span>
              </div>
              <div class="home-progress">
                <div class="home-progress__item">
                  <span id="dashboard-sessions" class="home-progress__value">0</span>
                  <span class="home-progress__label">phi√™n</span>
                </div>
                <div class="home-progress__divider"></div>
                <div class="home-progress__item">
                  <span id="dashboard-minutes" class="home-progress__value">0</span>
                  <span class="home-progress__label">ph√∫t</span>
                </div>
                <div class="home-progress__divider"></div>
                <div class="home-progress__item">
                  <span id="dashboard-goal" class="home-progress__value">0%</span>
                  <span class="home-progress__label">m·ª•c ti√™u</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Sessions -->
          <div class="home-section">
            <div class="home-section__header">
              <span class="home-section__icon">üìã</span>
              <h3>Phi√™n g·∫ßn ƒë√¢y</h3>
            </div>
            <ul id="dashboard-recent-sessions" class="recent-list"></ul>
          </div>
        </section>

        <!-- View: Priority Task Flow -->
        <section id="view-tasks" class="view is-active">
          <header class="view-header view-header--flow1">
            <div class="view-header__top">
              <div class="view-step-badge">
                <span class="view-step-badge__icon">üéØ</span>
                <span>Step 1</span>
              </div>
              <div id="tasks-next-hint" class="flow-next-btn" hidden>
                <button class="btn btn--accent btn--small" data-goto="blocks">
                  Ti·∫øp ‚Üí Time Flow
                  <span class="btn__arrow">‚Üí</span>
                </button>
              </div>
            </div>
            <h2>Priority Flow</h2>
            <p class="view-desc">X√°c ƒë·ªãnh vi·ªác quan tr·ªçng ¬∑ Ph√¢n lo·∫°i theo Eisenhower Matrix</p>
          </header>

          <!-- Input card ƒë·∫πp h∆°n -->
          <div class="task-add-card">
            <div class="task-add-header">
              <span class="task-add-header__icon">‚úèÔ∏è</span>
              <span class="task-add-header__text">Th√™m vi·ªác m·ªõi</span>
            </div>
            <div class="task-add-main">
              <input id="task-input" type="text" placeholder="Vi·ªác c·∫ßn l√†m l√† g√¨?" class="task-add-input" aria-label="Nh·∫≠p vi·ªác c·∫ßn l√†m" />
              <button id="add-task-btn" class="btn btn--primary btn--icon" aria-label="Th√™m vi·ªác m·ªõi">
                <span>+</span>
              </button>
            </div>
            <div class="task-add-options-row">
              <div class="task-add-toggles">
                <label class="toggle-chip toggle-chip--important" data-tooltip="Vi·ªác quan tr·ªçng, ·∫£nh h∆∞·ªüng l·ªõn">
                  <input id="task-important" type="checkbox" />
                  <span class="toggle-chip__icon">‚≠ê</span>
                  <span class="toggle-chip__label">Quan tr·ªçng</span>
                </label>
                <label class="toggle-chip toggle-chip--urgent" data-tooltip="Vi·ªác c·∫ßn l√†m ngay, c√≥ deadline g·∫•p">
                  <input id="task-urgent" type="checkbox" />
                  <span class="toggle-chip__icon">‚ö°</span>
                  <span class="toggle-chip__label">Kh·∫©n c·∫•p</span>
                </label>
              </div>
              <span class="task-add-hint">Ch·ªçn ƒë·ªÉ ph√¢n lo·∫°i t·ª± ƒë·ªông</span>
            </div>
            <input id="task-estimate" type="hidden" value="30" />
          </div>

          <!-- Ma tr·∫≠n Eisenhower 2x2 v·ªõi labels -->
          <div class="matrix-wrapper">
            <div class="matrix-labels matrix-labels--top">
              <span></span>
              <span class="matrix-label">‚ö° KH·∫®N C·∫§P</span>
              <span class="matrix-label matrix-label--muted">KH√îNG G·∫§P</span>
            </div>
            <div class="matrix-with-labels">
              <div class="matrix-labels matrix-labels--left">
                <span class="matrix-label">‚≠ê QUAN TR·ªåNG</span>
                <span class="matrix-label matrix-label--muted">KH√îNG QUAN TR·ªåNG</span>
              </div>
              <div class="matrix-eisenhower">
                <div class="matrix-quadrant matrix-quadrant--do">
                  <div class="matrix-quadrant__header">
                    <span class="matrix-quadrant__badge">1</span>
                    <h3>üî• L√†m ngay</h3>
                  </div>
                  <p class="matrix-quadrant__desc">∆Øu ti√™n cao nh·∫•t</p>
                  <ul id="matrix-do" class="task-list"></ul>
                </div>

                <div class="matrix-quadrant matrix-quadrant--schedule">
                  <div class="matrix-quadrant__header">
                    <span class="matrix-quadrant__badge">2</span>
                    <h3>üìÖ L√™n l·ªãch</h3>
                  </div>
                  <p class="matrix-quadrant__desc">L·∫≠p k·∫ø ho·∫°ch th·ª±c hi·ªán</p>
                  <ul id="matrix-schedule" class="task-list"></ul>
                </div>

                <div class="matrix-quadrant matrix-quadrant--delegate">
                  <div class="matrix-quadrant__header">
                    <span class="matrix-quadrant__badge">3</span>
                    <h3>üë• ·ª¶y quy·ªÅn</h3>
                  </div>
                  <p class="matrix-quadrant__desc">Nh·ªù ng∆∞·ªùi kh√°c h·ªó tr·ª£</p>
                  <ul id="matrix-delegate" class="task-list"></ul>
                </div>

                <div class="matrix-quadrant matrix-quadrant--eliminate">
                  <div class="matrix-quadrant__header">
                    <span class="matrix-quadrant__badge">4</span>
                    <h3>üóëÔ∏è Lo·∫°i b·ªè</h3>
                  </div>
                  <p class="matrix-quadrant__desc">C√¢n nh·∫Øc b·ªè qua</p>
                  <ul id="matrix-eliminate" class="task-list"></ul>
                </div>
              </div>
            </div>
          </div>

          <div class="task-footer">
            <span id="task-meta" class="task-footer__meta">0 vi·ªác</span>
            <button id="clear-completed-btn" class="btn btn--ghost btn--small">
              <span>üßπ</span> X√≥a vi·ªác ƒë√£ xong
            </button>
          </div>
        </section>

        <!-- View: Deep Work Flow -->
        <section id="view-timer" class="view">
          <header class="view-header view-header--flow3">
            <div class="view-header__top">
              <div class="view-step-badge view-step-badge--flow3">
                <span class="view-step-badge__icon">üî•</span>
                <span>Step 3</span>
              </div>
            </div>
            <h2>Deep Flow</h2>
            <p class="view-desc">T·∫≠p trung s√¢u ¬∑ Ho√†n th√†nh c√¥ng vi·ªác</p>
          </header>

          <div class="timer-flow-layout">
            <!-- C·ªôt tr√°i: Block c·∫ßn l√†m -->
            <div class="timer-blocks-panel">
              <div class="timer-panel-header">
                <div class="timer-panel-title">
                  <span class="timer-panel-icon">‚è∞</span>
                  <h3>Block t·ª´ Time Flow</h3>
                </div>
                <span class="timer-panel-hint">Ch·ªçn ƒë·ªÉ focus</span>
              </div>

              <!-- Blocks t·ª´ Flow 2 -->
              <div id="timer-work-options" class="timer-block-list">
                <!-- Render b·∫±ng JS -->
              </div>

              <!-- Empty state -->
              <div id="timer-no-work" class="timer-empty-blocks" hidden>
                <div class="timer-empty-blocks__content">
                  <span class="timer-empty-blocks__icon">‚è∞</span>
                  <span class="timer-empty-blocks__title">Ch∆∞a c√≥ block n√†o</span>
                  <span class="timer-empty-blocks__text">L√™n l·ªãch ·ªü Time Flow tr∆∞·ªõc</span>
                  <button class="btn btn--outline btn--small" data-goto="blocks">
                    ‚Üê Quay l·∫°i Time Flow
                  </button>
                </div>
              </div>
            </div>

            <!-- C·ªôt ph·∫£i: Timer -->
            <div class="timer-focus-panel">
              <div id="timer-context" class="timer-context-card" hidden>
                <span class="timer-context__icon">üéØ</span>
                <div class="timer-context__info">
                  <span class="timer-context__label">ƒêang t·∫≠p trung</span>
                  <span id="timer-context-task" class="timer-context__task"></span>
                </div>
              </div>

              <div class="timer-display-wrapper">
                <div class="timer-mode">
                  <span id="mode-label">Phi√™n t·∫≠p trung</span>
                  <span id="mode-chip" class="timer-chip">Focus</span>
                </div>
                <div class="timer-ring-wrapper">
                  <svg class="timer-ring" viewBox="0 0 100 100">
                    <circle class="timer-ring__bg" cx="50" cy="50" r="45" />
                    <circle id="timer-ring-progress" class="timer-ring__progress" cx="50" cy="50" r="45" />
                  </svg>
                  <div id="timer-display" class="timer-display">50:00</div>
                </div>
              </div>

              <div class="timer-presets">
                <button class="preset-btn" data-focus-preset="25">25p</button>
                <button class="preset-btn is-active" data-focus-preset="50">50p</button>
                <button class="preset-btn" data-focus-preset="90">90p</button>
              </div>

              <div class="timer-controls">
                <button id="start-btn" class="btn btn--primary btn--large">B·∫Øt ƒë·∫ßu</button>
                <button id="reset-btn" class="btn btn--ghost">Reset</button>
                <button id="skip-btn" class="btn btn--ghost">B·ªè qua</button>
              </div>
            </div>
          </div>
        </section>

        <!-- View: Time Block Flow -->
        <section id="view-blocks" class="view">
          <header class="view-header view-header--flow2">
            <div class="view-header__top">
              <div class="view-step-badge view-step-badge--flow2">
                <span class="view-step-badge__icon">‚è∞</span>
                <span>Step 2</span>
              </div>
              <div id="blocks-next-hint" class="flow-next-btn" hidden>
                <button class="btn btn--accent btn--small" data-goto="timer">
                  Ti·∫øp ‚Üí Deep Flow
                  <span class="btn__arrow">‚Üí</span>
                </button>
              </div>
            </div>
            <h2>Time Flow</h2>
            <p class="view-desc">Ph√¢n b·ªï th·ªùi gian ¬∑ L√™n l·ªãch c√°c block t·∫≠p trung</p>
          </header>

          <!-- Layout m·ªõi: Vertical stack -->
          <div class="block-layout-vertical">
            <!-- Ph·∫ßn tr√™n: Task t·ª´ Priority Flow (compact) -->
            <div class="block-tasks-bar">
              <div class="block-tasks-bar__header">
                <div class="block-tasks-bar__title">
                  <span class="block-tasks-bar__icon">üìã</span>
                  <h3>Task ch·ªù l√™n l·ªãch</h3>
                  <span class="block-tasks-bar__hint">Nh·∫•n ƒë·ªÉ th√™m v√†o timeline ‚Üì</span>
                </div>
                <button class="btn btn--ghost btn--small" data-goto="tasks">+ Th√™m task</button>
              </div>

              <div class="block-tasks-bar__content">
                <!-- Task items horizontal scroll -->
                <div id="block-tasks-horizontal" class="block-tasks-horizontal">
                  <!-- Render by JS -->
                </div>

                <!-- Empty state -->
                <div id="block-no-tasks" class="block-tasks-bar__empty" hidden>
                  <span>Ch∆∞a c√≥ task. </span>
                  <button class="btn btn--outline btn--small" data-goto="tasks">Th√™m ·ªü Priority Flow</button>
                </div>
              </div>
            </div>

            <!-- Ph·∫ßn d∆∞·ªõi: L·ªãch h√¥m nay (Full width) -->
            <div class="block-schedule-full">
              <div class="block-schedule-full__header">
                <div class="block-schedule-full__title">
                  <span class="block-schedule-full__icon">üìÖ</span>
                  <h3>L·ªãch h√¥m nay</h3>
                </div>
                <div class="block-schedule-full__meta">
                  <span id="block-summary" class="block-schedule-full__summary"></span>
                </div>
              </div>

              <!-- Quick add bar -->
              <div class="block-quick-add-bar">
                <div class="block-quick-add-bar__field">
                  <label for="block-start">Gi·ªù b·∫Øt ƒë·∫ßu</label>
                  <input id="block-start" type="time" class="block-quick-time" />
                </div>
                <div class="block-quick-add-bar__field block-quick-add-bar__field--grow">
                  <label for="block-title">T√™n block</label>
                  <input id="block-title" type="text" placeholder="VD: Vi·∫øt b√°o c√°o, Meeting..." class="block-quick-title" />
                </div>
                <div class="block-quick-add-bar__field">
                  <label for="block-duration">Th·ªùi l∆∞·ª£ng</label>
                  <input id="block-duration" type="number" min="10" max="240" placeholder="30" class="block-quick-duration" />
                  <span class="block-quick-add-bar__unit">ph√∫t</span>
                </div>
                <div class="block-quick-add-bar__field">
                  <label>M√†u</label>
                  <div class="block-color-wrapper">
                    <button type="button" class="block-color-trigger" id="block-color-trigger">
                      <span class="block-color-trigger__preview" id="block-color-preview"></span>
                      <span class="block-color-trigger__arrow">‚ñº</span>
                    </button>
                    <div class="block-color-popup" id="block-color-popup" hidden>
                      <div class="block-color-popup__grid" id="block-color-picker">
                        <!-- 20 colors -->
                        <button type="button" class="block-color-btn is-active" data-color="green" title="Xanh l√°"></button>
                        <button type="button" class="block-color-btn" data-color="emerald" title="Ng·ªçc l·ª•c b·∫£o"></button>
                        <button type="button" class="block-color-btn" data-color="teal" title="Xanh l·ª•c lam"></button>
                        <button type="button" class="block-color-btn" data-color="cyan" title="Xanh cyan"></button>
                        <button type="button" class="block-color-btn" data-color="blue" title="Xanh d∆∞∆°ng"></button>
                        <button type="button" class="block-color-btn" data-color="indigo" title="Ch√†m"></button>
                        <button type="button" class="block-color-btn" data-color="purple" title="T√≠m"></button>
                        <button type="button" class="block-color-btn" data-color="violet" title="T√≠m violet"></button>
                        <button type="button" class="block-color-btn" data-color="pink" title="H·ªìng"></button>
                        <button type="button" class="block-color-btn" data-color="rose" title="H·ªìng ƒë·∫≠m"></button>
                        <button type="button" class="block-color-btn" data-color="red" title="ƒê·ªè"></button>
                        <button type="button" class="block-color-btn" data-color="orange" title="Cam"></button>
                        <button type="button" class="block-color-btn" data-color="amber" title="H·ªï ph√°ch"></button>
                        <button type="button" class="block-color-btn" data-color="yellow" title="V√†ng"></button>
                        <button type="button" class="block-color-btn" data-color="lime" title="Xanh chanh"></button>
                        <button type="button" class="block-color-btn" data-color="brown" title="N√¢u"></button>
                        <button type="button" class="block-color-btn" data-color="stone" title="ƒê√°"></button>
                        <button type="button" class="block-color-btn" data-color="slate" title="X√°m xanh"></button>
                        <button type="button" class="block-color-btn" data-color="zinc" title="X√°m"></button>
                        <button type="button" class="block-color-btn" data-color="neutral" title="Trung t√≠nh"></button>
                      </div>
                    </div>
                  </div>
                </div>
                <button id="add-block-btn" class="btn btn--primary" title="Th√™m block">
                  <span>+ Th√™m block</span>
                </button>
              </div>

              <!-- Hidden field for task link -->
              <select id="block-task-link" class="block-add-select" hidden>
                <option value="">Ch·ªçn t·ª´ task ƒë√£ th√™m...</option>
              </select>

              <!-- Gantt Chart Timeline - Full width -->
              <div class="gantt-container-full">
                <div class="gantt-header">
                  <span class="gantt-header__icon">üìä</span>
                  <span class="gantt-header__title">Timeline tr·ª±c quan</span>
                </div>
                <div class="gantt-timeline-full">
                  <div class="gantt-time-axis" id="gantt-time-axis">
                    <!-- Time markers render by JS -->
                  </div>
                  <div class="gantt-now-line" id="gantt-now-line"></div>
                  <div class="gantt-blocks" id="gantt-blocks">
                    <!-- Blocks render by JS -->
                  </div>
                </div>
              </div>

              <!-- Block list details -->
              <div class="block-list-section">
                <div class="block-list-section__header">
                  <span class="block-list-section__icon">üìù</span>
                  <span class="block-list-section__title">Chi ti·∫øt c√°c block</span>
                </div>
                <ul id="block-list" class="block-list-grid"></ul>
              </div>

              <!-- Empty timeline -->
              <div id="block-empty-schedule" class="block-empty-schedule-full" hidden>
                <div class="block-empty-schedule-full__content">
                  <span class="block-empty-schedule-full__icon">üìÖ</span>
                  <span class="block-empty-schedule-full__title">Ch∆∞a c√≥ block n√†o trong l·ªãch</span>
                  <span class="block-empty-schedule-full__text">Ch·ªçn task ·ªü tr√™n ho·∫∑c t·∫°o block m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu l√™n l·ªãch</span>
                </div>
              </div>
            </div>
          </div>

          <div class="block-footer">
            <span id="block-meta" class="block-footer__meta">0 block</span>
          </div>
        </section>

        <!-- View: Stats (Analytics) -->
        <section id="view-stats" class="view">
          <header class="view-header view-header--analytics">
            <div class="view-header__top">
              <div class="view-step-badge view-step-badge--analytics">
                <span class="view-step-badge__icon">üìà</span>
                <span>Analytics</span>
              </div>
            </div>
            <h2>Analytics</h2>
            <p class="view-desc">Ph√¢n t√≠ch hi·ªáu su·∫•t ¬∑ Theo d√µi ti·∫øn ƒë·ªô</p>
          </header>

          <!-- Analytics Cards -->
          <div class="analytics-grid">
            <!-- Goal Progress Card -->
            <div class="analytics-card analytics-card--goal">
              <div class="analytics-card__header">
                <span class="analytics-card__icon">üéØ</span>
                <span class="analytics-card__title">M·ª•c ti√™u h√¥m nay</span>
              </div>
              <div class="analytics-card__content">
                <div class="stat-card__ring" id="goal-ring" style="--progress: 0deg">
                  <div class="stat-card__ring-inner">
                    <span id="goal-progress">0/4</span>
                    <small>phi√™n</small>
                  </div>
                </div>
                <p id="goal-remaining" class="stat-card__message">C√≤n 4 phi√™n ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u.</p>
              </div>
            </div>

            <!-- Stats Cards -->
            <div class="analytics-card">
              <div class="analytics-card__header">
                <span class="analytics-card__icon">‚ö°</span>
                <span class="analytics-card__title">Phi√™n h√¥m nay</span>
              </div>
              <div class="analytics-card__value">
                <span id="stat-today" class="analytics-number">0</span>
                <span class="analytics-unit">phi√™n</span>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card__header">
                <span class="analytics-card__icon">‚è±Ô∏è</span>
                <span class="analytics-card__title">Th·ªùi gian focus</span>
              </div>
              <div class="analytics-card__value">
                <span id="stat-minutes" class="analytics-number">0</span>
                <span class="analytics-unit">ph√∫t</span>
              </div>
            </div>

            <div class="analytics-card analytics-card--streak">
              <div class="analytics-card__header">
                <span class="analytics-card__icon">üî•</span>
                <span class="analytics-card__title">Streak</span>
              </div>
              <div class="analytics-card__value">
                <span id="stat-streak" class="analytics-number">0</span>
                <span class="analytics-unit">ng√†y li√™n t·ª•c</span>
              </div>
            </div>
          </div>

          <!-- Weekly Chart -->
          <div class="analytics-section">
            <div class="analytics-section__header">
              <span class="analytics-section__icon">üìä</span>
              <h3>Bi·ªÉu ƒë·ªì 7 ng√†y</h3>
            </div>
            <div id="week-chart" class="week-chart"></div>
            <p id="week-total" class="analytics-section__summary"></p>
          </div>

          <!-- Session History -->
          <div class="analytics-section">
            <div class="analytics-section__header">
              <span class="analytics-section__icon">üìã</span>
              <h3>L·ªãch s·ª≠ phi√™n g·∫ßn ƒë√¢y</h3>
            </div>
            <ul id="session-list" class="session-list"></ul>
          </div>
        </section>

        <!-- View: Guide (H∆∞·ªõng d·∫´n) -->
        <section id="view-guide" class="view">
          <header class="view-header view-header--guide">
            <div class="view-header__top">
              <div class="view-step-badge view-step-badge--guide">
                <span class="view-step-badge__icon">üìñ</span>
                <span>H∆∞·ªõng d·∫´n</span>
              </div>
            </div>
            <h2>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h2>
            <p class="view-desc">T√¨m hi·ªÉu c√°ch s·ª≠ d·ª•ng FocusFlow hi·ªáu qu·∫£</p>
          </header>

          <!-- Guide Content -->
          <div class="guide-content">
            <!-- Overview -->
            <div class="guide-section guide-section--highlight">
              <div class="guide-section__header">
                <span class="guide-section__icon">üéØ</span>
                <h3>FocusFlow l√† g√¨?</h3>
              </div>
              <p class="guide-section__text">
                FocusFlow l√† ·ª©ng d·ª•ng gi√∫p b·∫°n t·∫≠p trung l√†m vi·ªác hi·ªáu qu·∫£ th√¥ng qua quy tr√¨nh 3 b∆∞·ªõc ƒë∆°n gi·∫£n:
                <strong>X√°c ƒë·ªãnh ∆∞u ti√™n ‚Üí L√™n l·ªãch ‚Üí T·∫≠p trung s√¢u</strong>.
              </p>
            </div>

            <!-- 3 Steps Flow -->
            <div class="guide-section">
              <div class="guide-section__header">
                <span class="guide-section__icon">üîÑ</span>
                <h3>Quy tr√¨nh 3 b∆∞·ªõc</h3>
              </div>

              <div class="guide-steps">
                <div class="guide-step">
                  <div class="guide-step__number">1</div>
                  <div class="guide-step__content">
                    <h4>üéØ Priority Flow</h4>
                    <p>Li·ªát k√™ t·∫•t c·∫£ vi·ªác c·∫ßn l√†m v√† ph√¢n lo·∫°i theo Ma tr·∫≠n Eisenhower:</p>
                    <ul>
                      <li><strong>üî• L√†m ngay:</strong> Quan tr·ªçng + Kh·∫©n c·∫•p</li>
                      <li><strong>üìÖ L√™n l·ªãch:</strong> Quan tr·ªçng + Kh√¥ng g·∫•p</li>
                      <li><strong>üë• ·ª¶y quy·ªÅn:</strong> Kh√¥ng quan tr·ªçng + Kh·∫©n c·∫•p</li>
                      <li><strong>üóëÔ∏è Lo·∫°i b·ªè:</strong> Kh√¥ng quan tr·ªçng + Kh√¥ng g·∫•p</li>
                    </ul>
                    <p class="guide-tip">üí° <em>K√©o th·∫£ task gi·ªØa c√°c √¥ ƒë·ªÉ thay ƒë·ªïi ƒë·ªô ∆∞u ti√™n</em></p>
                  </div>
                </div>

                <div class="guide-step">
                  <div class="guide-step__number">2</div>
                  <div class="guide-step__content">
                    <h4>‚è∞ Time Flow</h4>
                    <p>L√™n l·ªãch c√°c block th·ªùi gian cho t·ª´ng c√¥ng vi·ªác:</p>
                    <ul>
                      <li>Nh·∫•n v√†o task ·ªü thanh tr√™n ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn form</li>
                      <li>Ch·ªçn gi·ªù b·∫Øt ƒë·∫ßu, th·ªùi l∆∞·ª£ng v√† m√†u s·∫Øc</li>
                      <li>Xem timeline tr·ª±c quan tr√™n Gantt Chart</li>
                      <li>C√°c block s·∫Ω t·ª± ƒë·ªông x·∫øp h√†ng n·∫øu g·∫ßn nhau</li>
                    </ul>
                    <p class="guide-tip">üí° <em>Ch·ªçn m√†u kh√°c nhau ƒë·ªÉ ph√¢n bi·ªát lo·∫°i c√¥ng vi·ªác</em></p>
                  </div>
                </div>

                <div class="guide-step">
                  <div class="guide-step__number">3</div>
                  <div class="guide-step__content">
                    <h4>üî• Deep Flow</h4>
                    <p>B·∫Øt ƒë·∫ßu phi√™n t·∫≠p trung v·ªõi timer Pomodoro:</p>
                    <ul>
                      <li>Ch·ªçn block ho·∫∑c task mu·ªën focus</li>
                      <li>Ch·ªçn th·ªùi l∆∞·ª£ng: 25p, 50p ho·∫∑c 90p</li>
                      <li>Nh·∫•n "B·∫Øt ƒë·∫ßu" v√† t·∫≠p trung ho√†n to√†n</li>
                      <li>Khi h·∫øt gi·ªù, ngh·ªâ ng∆°i r·ªìi ti·∫øp t·ª•c</li>
                    </ul>
                    <p class="guide-tip">üí° <em>50 ph√∫t l√† th·ªùi l∆∞·ª£ng t·ªëi ∆∞u cho deep work</em></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tips -->
            <div class="guide-section">
              <div class="guide-section__header">
                <span class="guide-section__icon">üí°</span>
                <h3>M·∫πo s·ª≠ d·ª•ng hi·ªáu qu·∫£</h3>
              </div>

              <div class="guide-tips-grid">
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">üåÖ</span>
                  <h5>L·∫≠p k·∫ø ho·∫°ch bu·ªïi s√°ng</h5>
                  <p>D√†nh 5-10 ph√∫t ƒë·∫ßu ng√†y ƒë·ªÉ x√°c ƒë·ªãnh 3 vi·ªác quan tr·ªçng nh·∫•t.</p>
                </div>
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">üéØ</span>
                  <h5>T·∫≠p trung v√†o Q1 & Q2</h5>
                  <p>∆Øu ti√™n vi·ªác "L√†m ngay" v√† "L√™n l·ªãch" - ƒë√¢y l√† vi·ªác c√≥ impact cao nh·∫•t.</p>
                </div>
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">‚è±Ô∏è</span>
                  <h5>Time blocking</h5>
                  <p>L√™n l·ªãch c·ª• th·ªÉ gi√∫p n√£o b·ªô chu·∫©n b·ªã s·∫µn s√†ng cho c√¥ng vi·ªác.</p>
                </div>
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">üîï</span>
                  <h5>Lo·∫°i b·ªè xao nh√£ng</h5>
                  <p>T·∫Øt th√¥ng b√°o, ƒë√≥ng tab kh√¥ng c·∫ßn thi·∫øt khi ƒëang trong phi√™n focus.</p>
                </div>
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">‚òï</span>
                  <h5>Ngh·ªâ ng∆°i ƒë√∫ng c√°ch</h5>
                  <p>ƒê·ª©ng d·∫≠y, u·ªëng n∆∞·ªõc, nh√¨n xa trong th·ªùi gian break.</p>
                </div>
                <div class="guide-tip-card">
                  <span class="guide-tip-card__icon">üìä</span>
                  <h5>Theo d√µi ti·∫øn ƒë·ªô</h5>
                  <p>Xem Analytics ƒë·ªÉ bi·∫øt xu h∆∞·ªõng l√†m vi·ªác v√† ƒëi·ªÅu ch·ªânh ph√π h·ª£p.</p>
                </div>
              </div>
            </div>

            <!-- Keyboard shortcuts -->
            <div class="guide-section">
              <div class="guide-section__header">
                <span class="guide-section__icon">‚å®Ô∏è</span>
                <h3>Ph√≠m t·∫Øt</h3>
              </div>
              <div class="guide-shortcuts">
                <div class="guide-shortcut">
                  <kbd>Enter</kbd>
                  <span>Th√™m task m·ªõi (khi ƒëang nh·∫≠p)</span>
                </div>
                <div class="guide-shortcut">
                  <kbd>Drag & Drop</kbd>
                  <span>K√©o th·∫£ task gi·ªØa c√°c √¥ ∆∞u ti√™n</span>
                </div>
              </div>
            </div>

            <!-- Credits -->
            <div class="guide-section guide-section--credits">
              <p>Made with ‚ù§Ô∏è by <strong>GYB Agent</strong></p>
              <p class="guide-version">FocusFlow v1.0</p>
            </div>
          </div>
        </section>

        <!-- View: Settings -->
        <section id="view-settings" class="view">
          <header class="view-header">
            <h2>T√πy ch·ªânh</h2>
            <p class="view-desc">ƒêi·ªÅu ch·ªânh cho ph√π h·ª£p v·ªõi nh·ªãp c·ªßa b·∫°n</p>
          </header>

          <div class="settings-sections">
            <div class="settings-group">
              <h3>Giao di·ªán</h3>
              <div class="theme-selector" id="theme-selector">
                <button type="button" class="theme-selector__btn" data-theme-value="dark">
                  <span class="theme-selector__icon">üåô</span>
                  <span>T·ªëi</span>
                </button>
                <button type="button" class="theme-selector__btn" data-theme-value="auto">
                  <span class="theme-selector__icon">üíª</span>
                  <span>T·ª± ƒë·ªông</span>
                </button>
                <button type="button" class="theme-selector__btn" data-theme-value="light">
                  <span class="theme-selector__icon">‚òÄÔ∏è</span>
                  <span>S√°ng</span>
                </button>
              </div>
              <p class="settings-hint">T·ª± ƒë·ªông s·∫Ω theo c√†i ƒë·∫∑t h·ªá th·ªëng c·ªßa b·∫°n.</p>
            </div>

            <div class="settings-group">
              <h3>M·ª•c ti√™u</h3>
              <label class="settings-row">
                <span>S·ªë phi√™n m·ª•c ti√™u/ng√†y</span>
                <input id="goal-input" type="number" min="1" max="12" />
              </label>
            </div>

            <div class="settings-group">
              <h3>Th·ªùi l∆∞·ª£ng</h3>
              <label class="settings-row">
                <span>Focus (ph√∫t)</span>
                <input id="focus-minutes" type="number" min="10" max="90" />
              </label>
              <label class="settings-row">
                <span>Break (ph√∫t)</span>
                <input id="break-minutes" type="number" min="3" max="30" />
              </label>
            </div>

            <div class="settings-group">
              <h3>H√†nh vi</h3>
              <label class="settings-toggle">
                <input id="auto-toggle" type="checkbox" />
                <span>T·ª± ƒë·ªông chuy·ªÉn phi√™n</span>
              </label>
              <label class="settings-toggle">
                <input id="sound-toggle" type="checkbox" />
                <span>√Çm b√°o khi h·∫øt phi√™n</span>
              </label>
              <label class="settings-toggle">
                <input id="notify-toggle" type="checkbox" />
                <span>Th√¥ng b√°o h·ªá th·ªëng</span>
              </label>
              <p id="notify-status" class="settings-hint"></p>
            </div>

            <button id="apply-settings-btn" class="btn btn--primary">L∆∞u c√†i ƒë·∫∑t</button>

            <div class="settings-group">
              <h3>D·ªØ li·ªáu</h3>
              <div class="settings-data-actions">
                <button id="export-data-btn" class="btn btn--outline">üì§ Xu·∫•t d·ªØ li·ªáu</button>
                <button id="import-data-btn" class="btn btn--outline">üì• Nh·∫≠p d·ªØ li·ªáu</button>
                <input id="import-file-input" type="file" accept=".json" hidden />
              </div>
              <p class="settings-hint">Xu·∫•t/nh·∫≠p to√†n b·ªô tasks, blocks, sessions v√† c√†i ƒë·∫∑t.</p>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Modal ho√†n th√†nh phi√™n -->
    <div id="completion-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
      <div class="modal__backdrop"></div>
      <div class="modal__content">
        <div class="modal__header">
          <span class="modal__icon">üéâ</span>
          <h3 id="modal-title">Ho√†n th√†nh phi√™n focus!</h3>
        </div>
        <p id="modal-message" class="modal__message">B·∫°n v·ª´a ho√†n th√†nh 50 ph√∫t t·∫≠p trung.</p>

        <!-- Block ƒëang l√†m -->
        <div id="modal-block-section" class="modal__section" hidden>
          <p class="modal__label">üìê Block v·ª´a ho√†n th√†nh:</p>
          <p id="modal-block-name" class="modal__task-name"></p>
        </div>

        <!-- Task ƒëang l√†m -->
        <div id="modal-task-section" class="modal__section" hidden>
          <p class="modal__label">üéØ Task ƒëang l√†m:</p>
          <p id="modal-task-name" class="modal__task-name"></p>
          <button id="modal-mark-done" class="btn btn--success btn--full">‚úì ƒê√°nh d·∫•u task ho√†n th√†nh</button>
        </div>

        <!-- Ti·∫øp theo -->
        <div id="modal-next-section" class="modal__section">
          <p class="modal__label">Ti·∫øp theo:</p>
          <div id="modal-next-block" class="modal__next-item" hidden>
            <span id="modal-next-block-name"></span>
            <button id="modal-start-next-block" class="btn btn--accent btn--small">üî• Focus</button>
          </div>
          <div id="modal-next-task" class="modal__next-item" hidden>
            <span id="modal-next-task-name"></span>
            <button id="modal-start-next-task" class="btn btn--ghost btn--small">B·∫Øt ƒë·∫ßu</button>
          </div>
          <p id="modal-no-next" class="muted" hidden>Tuy·ªát v·ªùi! Kh√¥ng c√≤n vi·ªác n√†o. Ngh·ªâ ng∆°i ƒëi! üåü</p>
        </div>

        <div class="modal__actions">
          <button id="modal-take-break" class="btn btn--ghost">‚òï Ngh·ªâ ng∆°i</button>
          <button id="modal-close" class="btn btn--primary">ƒê√≥ng</button>
        </div>
      </div>
    </div>

    <!-- Custom Prompt Modal -->
    <div id="custom-prompt-modal" class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="custom-prompt-title" hidden>
      <div class="custom-modal__backdrop"></div>
      <div class="custom-modal__content">
        <h3 id="custom-prompt-title" class="custom-modal__title"></h3>
        <input id="custom-prompt-input" type="text" class="custom-modal__input" autocomplete="off" />
        <div class="custom-modal__actions">
          <button id="custom-prompt-cancel" class="btn btn--ghost">H·ªßy</button>
          <button id="custom-prompt-ok" class="btn btn--primary">X√°c nh·∫≠n</button>
        </div>
      </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="custom-confirm-title" hidden>
      <div class="custom-modal__backdrop"></div>
      <div class="custom-modal__content">
        <h3 id="custom-confirm-title" class="custom-modal__title"></h3>
        <p id="custom-confirm-message" class="custom-modal__message"></p>
        <div class="custom-modal__actions">
          <button id="custom-confirm-cancel" class="btn btn--ghost">H·ªßy</button>
          <button id="custom-confirm-ok" class="btn btn--primary">X√°c nh·∫≠n</button>
        </div>
      </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="shortcuts-modal" hidden>
      <div class="shortcuts-modal__backdrop"></div>
      <div class="shortcuts-modal__content">
        <div class="shortcuts-modal__header">
          <div class="shortcuts-modal__title-row">
            <span class="shortcuts-modal__icon">‚å®Ô∏è</span>
            <h3>Phim tat</h3>
          </div>
          <button id="shortcuts-modal-close" class="shortcuts-modal__close" aria-label="Dong">&times;</button>
        </div>
        <div class="shortcuts-modal__grid">
          <div class="shortcuts-modal__group">
            <h4>Di chuyen</h4>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>1</kbd></div>
              <span>Priority Flow</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>2</kbd></div>
              <span>Time Flow</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>3</kbd></div>
              <span>Deep Flow</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>4</kbd></div>
              <span>Analytics</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>5</kbd></div>
              <span>Settings</span>
            </div>
          </div>
          <div class="shortcuts-modal__group">
            <h4>Timer</h4>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>Space</kbd></div>
              <span>Bat dau / Tam dung</span>
            </div>
          </div>
          <div class="shortcuts-modal__group">
            <h4>Task</h4>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>N</kbd></div>
              <span>Them task moi</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>Enter</kbd></div>
              <span>Xac nhan them task</span>
            </div>
          </div>
          <div class="shortcuts-modal__group">
            <h4>Chung</h4>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>?</kbd></div>
              <span>Mo phim tat</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>Ctrl</kbd><span class="shortcuts-modal__plus">+</span><kbd>Z</kbd></div>
              <span>Hoan tac</span>
            </div>
            <div class="shortcuts-modal__item">
              <div class="shortcuts-modal__keys"><kbd>Esc</kbd></div>
              <span>Dong modal / popup</span>
            </div>
          </div>
        </div>
        <div class="shortcuts-modal__footer">
          <span>Nhan <kbd>Esc</kbd> de dong</span>
        </div>
      </div>
    </div>

    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner" hidden>
      <div class="pwa-install-banner__content">
        <div class="pwa-install-banner__icon">üéØ</div>
        <div class="pwa-install-banner__text">
          <strong>Cai dat FocusFlow</strong>
          <span>Truy cap nhanh hon, hoat dong offline</span>
        </div>
      </div>
      <div class="pwa-install-banner__actions">
        <button id="pwa-install-dismiss" class="btn btn--ghost btn--small">De sau</button>
        <button id="pwa-install-btn" class="btn btn--accent btn--small">Cai dat</button>
      </div>
    </div>

    <!-- PWA Update Banner -->
    <div id="pwa-update-banner" class="pwa-update-banner" hidden>
      <div class="pwa-update-banner__content">
        <span class="pwa-update-banner__icon">üîÑ</span>
        <span>Phien ban moi da san sang!</span>
      </div>
      <button id="pwa-update-btn" class="btn btn--accent btn--small">Cap nhat</button>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator" hidden>
      <span class="offline-indicator__icon">üì°</span>
      <span class="offline-indicator__text">Dang offline</span>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

    <script src="app.js" defer></script>

    <!-- Supabase Auth & Sync Modules -->
    <script src="modules/supabase-config.js" defer></script>
    <script src="modules/auth.js" defer></script>
    <script src="modules/sync.js" defer></script>

    <!-- Premium Modules -->
    <script src="modules/onboarding.js" defer></script>
    <script src="modules/streaks.js" defer></script>
    <script src="modules/achievements.js" defer></script>
    <script src="modules/sounds.js" defer></script>
    <script src="modules/sharing.js" defer></script>
    <script src="modules/reflection.js" defer></script>

    <!-- Service Worker Registration & PWA Logic -->
    <script>
      // ============================================================
      // SERVICE WORKER REGISTRATION
      // ============================================================
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            const swPath = location.pathname.includes('/focusflow') ? '/focusflow/sw.js' : '/sw.js';
            const swScope = location.pathname.includes('/focusflow') ? '/focusflow/' : '/';
            const registration = await navigator.serviceWorker.register(swPath, {
              scope: swScope,
            });

            console.log('[PWA] Service Worker registered, scope:', registration.scope);

            // Check for updates on page load
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (!newWorker) return;

              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New version available, show update banner
                  showUpdateBanner(registration);
                }
              });
            });

            // Periodically check for updates (every 60 minutes)
            setInterval(() => {
              registration.update();
            }, 60 * 60 * 1000);

            // Register for background sync if supported
            if ('sync' in registration) {
              try {
                await registration.sync.register('focusflow-sync');
              } catch (err) {
                console.log('[PWA] Background sync registration failed:', err);
              }
            }

            // Register for periodic background sync if supported
            if ('periodicSync' in registration) {
              try {
                const status = await navigator.permissions.query({ name: 'periodic-background-sync' });
                if (status.state === 'granted') {
                  await registration.periodicSync.register('focusflow-periodic-sync', {
                    minInterval: 24 * 60 * 60 * 1000, // 24 hours
                  });
                }
              } catch (err) {
                console.log('[PWA] Periodic sync registration failed:', err);
              }
            }
          } catch (err) {
            console.error('[PWA] Service Worker registration failed:', err);
          }
        });

        // Listen for messages from service worker
        navigator.serviceWorker.addEventListener('message', (event) => {
          const { type, version } = event.data || {};

          switch (type) {
            case 'SW_ACTIVATED':
              console.log('[PWA] Service Worker activated, version:', version);
              break;

            case 'SW_UPDATE_AVAILABLE':
              console.log('[PWA] Content update detected');
              // Show a subtle notification that content has been updated
              if (typeof showToast === 'function') {
                showToast('Noi dung da duoc cap nhat. Tai lai de xem phien ban moi.', 'info', 5000);
              }
              break;

            case 'SYNC_COMPLETE':
              console.log('[PWA] Background sync completed');
              break;
          }
        });
      }

      // ============================================================
      // PWA INSTALL PROMPT
      // ============================================================
      let deferredInstallPrompt = null;
      const INSTALL_DISMISS_KEY = 'focusflow_install_dismissed';
      const INSTALL_DISMISS_DURATION = 7 * 24 * 60 * 60 * 1000; // 7 days

      window.addEventListener('beforeinstallprompt', (event) => {
        // Prevent the default mini-infobar
        event.preventDefault();
        deferredInstallPrompt = event;

        // Check if user previously dismissed
        const dismissedAt = localStorage.getItem(INSTALL_DISMISS_KEY);
        if (dismissedAt) {
          const elapsed = Date.now() - parseInt(dismissedAt, 10);
          if (elapsed < INSTALL_DISMISS_DURATION) {
            return; // Still within dismiss cooldown
          }
          localStorage.removeItem(INSTALL_DISMISS_KEY);
        }

        // Show custom install banner after a delay (don't interrupt immediately)
        setTimeout(() => {
          showInstallBanner();
        }, 30000); // 30 seconds delay
      });

      window.addEventListener('appinstalled', () => {
        console.log('[PWA] App installed successfully');
        deferredInstallPrompt = null;
        hideInstallBanner();

        if (typeof showToast === 'function') {
          showToast('FocusFlow da duoc cai dat thanh cong!', 'success');
        }

        // Track installation
        try {
          const installData = {
            installedAt: new Date().toISOString(),
            platform: navigator.userAgentData?.platform || navigator.platform || 'unknown',
          };
          localStorage.setItem('focusflow_pwa_installed', JSON.stringify(installData));
        } catch (err) {
          // ignore
        }
      });

      function showInstallBanner() {
        const banner = document.getElementById('pwa-install-banner');
        if (!banner || !deferredInstallPrompt) return;
        banner.hidden = false;
        requestAnimationFrame(() => {
          banner.classList.add('is-visible');
        });
      }

      function hideInstallBanner() {
        const banner = document.getElementById('pwa-install-banner');
        if (!banner) return;
        banner.classList.remove('is-visible');
        setTimeout(() => {
          banner.hidden = true;
        }, 300);
      }

      // Install button
      const installBtn = document.getElementById('pwa-install-btn');
      if (installBtn) {
        installBtn.addEventListener('click', async () => {
          if (!deferredInstallPrompt) return;

          hideInstallBanner();

          try {
            deferredInstallPrompt.prompt();
            const { outcome } = await deferredInstallPrompt.userChoice;
            console.log('[PWA] Install prompt outcome:', outcome);

            if (outcome === 'dismissed') {
              localStorage.setItem(INSTALL_DISMISS_KEY, String(Date.now()));
            }
          } catch (err) {
            console.error('[PWA] Install prompt error:', err);
          }

          deferredInstallPrompt = null;
        });
      }

      // Dismiss button
      const dismissBtn = document.getElementById('pwa-install-dismiss');
      if (dismissBtn) {
        dismissBtn.addEventListener('click', () => {
          hideInstallBanner();
          localStorage.setItem(INSTALL_DISMISS_KEY, String(Date.now()));
          deferredInstallPrompt = null;
        });
      }

      // ============================================================
      // PWA UPDATE BANNER
      // ============================================================
      function showUpdateBanner(registration) {
        const banner = document.getElementById('pwa-update-banner');
        if (!banner) return;

        banner.hidden = false;
        requestAnimationFrame(() => {
          banner.classList.add('is-visible');
        });

        const updateBtn = document.getElementById('pwa-update-btn');
        if (updateBtn) {
          updateBtn.addEventListener('click', () => {
            if (registration.waiting) {
              registration.waiting.postMessage({ type: 'SKIP_WAITING' });
            }
            banner.classList.remove('is-visible');
            setTimeout(() => {
              banner.hidden = true;
              window.location.reload();
            }, 300);
          }, { once: true });
        }
      }

      // ============================================================
      // OFFLINE / ONLINE INDICATOR
      // ============================================================
      const offlineIndicator = document.getElementById('offline-indicator');

      function updateOnlineStatus() {
        if (!offlineIndicator) return;

        if (!navigator.onLine) {
          offlineIndicator.hidden = false;
          requestAnimationFrame(() => {
            offlineIndicator.classList.add('is-visible');
          });
        } else {
          offlineIndicator.classList.remove('is-visible');
          setTimeout(() => {
            offlineIndicator.hidden = true;
          }, 300);
        }
      }

      window.addEventListener('online', () => {
        updateOnlineStatus();
        if (typeof showToast === 'function') {
          showToast('Da ket noi lai internet', 'success', 2500);
        }
      });

      window.addEventListener('offline', () => {
        updateOnlineStatus();
        if (typeof showToast === 'function') {
          showToast('Mat ket noi internet. Du lieu van duoc luu tru dia.', 'warning', 4000);
        }
      });

      // Check initial status
      updateOnlineStatus();

      // ============================================================
      // HANDLE SHORTCUT DEEP LINKS (?view=tasks, etc.)
      // ============================================================
      window.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const viewParam = params.get('view');
        if (viewParam && typeof navigateTo === 'function') {
          // Small delay to ensure app is booted
          setTimeout(() => {
            navigateTo(viewParam);
          }, 100);
        }
      });
    </script>
  </body>
</html>
